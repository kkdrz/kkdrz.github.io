<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.265f0e01cadcb0eb4549.css" id="gatsby-global-css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline}code,kbd,samp{font-family:monospace,monospace;font-size:1em}img{border-style:none}button,input{overflow:visible}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}[hidden]{display:none}

/*! tailwindcss v2.1.2 | MIT License | https://tailwindcss.com */

/*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */html{-moz-tab-size:4;-o-tab-size:4;tab-size:4;line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}hr{height:0;color:inherit}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],button{-webkit-appearance:button}legend{padding:0}progress{vertical-align:baseline}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{box-sizing:border-box;border:0 solid #e5e7eb}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input:-ms-input-placeholder,textarea:-ms-input-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.bg-white{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.bg-gray-600{--tw-bg-opacity:1;background-color:rgba(75,85,99,var(--tw-bg-opacity))}.border-black{--tw-border-opacity:1;border-color:rgba(0,0,0,var(--tw-border-opacity))}.border-gray-400{--tw-border-opacity:1;border-color:rgba(156,163,175,var(--tw-border-opacity))}.border-r-2{border-right-width:2px}.border-b-2{border-bottom-width:2px}.border-r{border-right-width:1px}.border-b{border-bottom-width:1px}.block{display:block}.flex{display:flex}.table{display:table}.hidden{display:none}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.flex-1{flex:1 1 0%}.font-medium{font-weight:500}.font-semibold{font-weight:600}.font-bold{font-weight:700}.h-7{height:1.75rem}.h-full{height:100%}.text-xs{font-size:.75rem;line-height:1rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem}.text-lg,.text-xl{line-height:1.75rem}.text-xl{font-size:1.25rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.leading-tight{line-height:1.25}.m-auto{margin:auto}.mx-auto{margin-left:auto;margin-right:auto}.mt-1{margin-top:.25rem}.ml-1{margin-left:.25rem}.mt-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2{margin-bottom:.5rem}.mt-4{margin-top:1rem}.mb-4{margin-bottom:1rem}.max-h-96{max-height:24rem}.max-w-md{max-width:28rem}.object-cover{-o-object-fit:cover;object-fit:cover}.overflow-hidden{overflow:hidden}.p-2{padding:.5rem}.p-3{padding:.75rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-4{padding-left:1rem;padding-right:1rem}.py-8{padding-top:2rem;padding-bottom:2rem}.pr-1{padding-right:.25rem}.pr-2{padding-right:.5rem}.pb-2{padding-bottom:.5rem}.pb-4{padding-bottom:1rem}*{--tw-shadow:0 0 transparent}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06)}.hover\:shadow-xl:hover,.shadow-md{box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow)}.hover\:shadow-xl:hover{--tw-shadow:0 20px 25px -5px rgba(0,0,0,0.1),0 10px 10px -5px rgba(0,0,0,0.04)}*{--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,0.5);--tw-ring-offset-shadow:0 0 transparent;--tw-ring-shadow:0 0 transparent}.text-left{text-align:left}.text-justify{text-align:justify}.text-white{--tw-text-opacity:1;color:rgba(255,255,255,var(--tw-text-opacity))}.text-gray-100{--tw-text-opacity:1;color:rgba(243,244,246,var(--tw-text-opacity))}.text-gray-300{--tw-text-opacity:1;color:rgba(209,213,219,var(--tw-text-opacity))}.text-gray-500{--tw-text-opacity:1;color:rgba(107,114,128,var(--tw-text-opacity))}.text-gray-600{--tw-text-opacity:1;color:rgba(75,85,99,var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgba(55,65,81,var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgba(31,41,55,var(--tw-text-opacity))}.hover\:text-gray-900:hover{--tw-text-opacity:1;color:rgba(17,24,39,var(--tw-text-opacity))}.hover\:text-blue-100:hover{--tw-text-opacity:1;color:rgba(219,234,254,var(--tw-text-opacity))}.uppercase{text-transform:uppercase}.hover\:no-underline:hover{text-decoration:none}.tracking-wide{letter-spacing:.025em}.whitespace-nowrap{white-space:nowrap}.w-0{width:0}.w-0\.5{width:.125rem}.w-1\/3{width:33.333333%}.w-full{width:100%}.transition{transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-200{transition-duration:.2s}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}#___gatsby,#gatsby-focus-wrapper,body,html{height:100%}#___gatsby,#gatsby-focus-wrapper,body,h1,h2,h3,h4,h5,h6,html{--tw-text-opacity:1;color:rgba(55,65,81,var(--tw-text-opacity))}h1,h2,h3,h4,h5,h6{font-weight:700;margin-top:1rem;margin-bottom:1rem}h1{font-size:1.875rem;line-height:2.25rem}h2{font-size:1.5rem;line-height:2rem}h3{font-size:1.25rem}h3,h4{line-height:1.75rem}h4{font-size:1.125rem}h5{font-size:1rem;line-height:1.5rem}h6{font-size:.75rem;line-height:1rem}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{text-decoration:none;color:inherit}p{line-height:1.625;margin-bottom:1rem;padding:0}ol,ul{list-style-position:outside;margin-bottom:.5rem;margin-left:1rem}ol{list-style-type:decimal}ul{list-style-type:disc}li>p,ol li,ul li{margin-bottom:.5rem}li :last-child{margin-bottom:0}blockquote{--tw-border-opacity:1;border-color:rgba(37,99,235,var(--tw-border-opacity));border-left-width:1px;margin-bottom:1.5rem;padding-left:1.5rem;font-size:1rem;line-height:1.5rem;--tw-text-opacity:1;color:rgba(107,114,128,var(--tw-text-opacity));font-style:italic}blockquote>:last-child{margin-bottom:0}blockquote>ol,blockquote>ul{list-style-position:inside}table{margin-bottom:2rem;width:100%}table thead tr th:empty{display:none}table thead tr th{border-bottom:1px solid var(--color-accent)}tr:nth-child(odd){--tw-bg-opacity:1;background-color:rgba(229,231,235,var(--tw-bg-opacity))}td,th{padding:.5rem 1rem}a{--tw-text-opacity:1;color:rgba(37,99,235,var(--tw-text-opacity))}a:focus,a:hover{text-decoration:underline}.gatsby-highlight{font-size:.875rem;line-height:1.25rem;margin-bottom:1rem}@media (min-width:640px){.sm\:block{display:block}.sm\:hidden{display:none}}@media (min-width:768px){.md\:flex{display:flex}.md\:flex-shrink-0{flex-shrink:0}.md\:h-10{height:2.5rem}.md\:text-4xl{font-size:2.25rem;line-height:2.5rem}.md\:max-w-2xl{max-width:42rem}.md\:w-1{width:.25rem}.md\:w-72{width:18rem}.md\:w-128{width:42rem}}@media (min-width:1024px){.lg\:h-14{height:3.5rem}.lg\:text-5xl{font-size:3rem;line-height:1}}@media (min-width:1280px){.xl\:flex-row{flex-direction:row}.xl\:flex-wrap{flex-wrap:wrap}.xl\:justify-center{justify-content:center}.xl\:px-6{padding-left:1.5rem;padding-right:1.5rem}}code[class*=language-],pre[class*=language-]{color:#a9b7c6;font-family:Consolas,Monaco,Andale Mono,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{color:inherit;background:rgba(33,66,131,.85)}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{color:inherit;background:rgba(33,66,131,.85)}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2b2b2b}:not(pre)>code[class*=language-]{padding:.2em .4em;margin:0 .1em;border-radius:6px;background-color:rgba(27,31,35,.05);color:#24292e;font-size:85%}.token.cdata,.token.comment,.token.prolog{color:grey}.token.atrule,.token.boolean,.token.delimiter,.token.important,.token.keyword,.token.selector{color:#cc7832}.token.attr-name,.token.operator,.token.punctuation{color:#a9b7c6}.token.builtin,.token.doctype,.token.tag,.token.tag .punctuation{color:#e8bf6a}.token.entity,.token.number,.token.symbol{color:#6897bb}.token.constant,.token.property,.token.variable{color:#9876aa}.token.char,.token.string{color:#6a8759}.token.attr-value,.token.attr-value .punctuation{color:#a5c261}.token.attr-value .punctuation:first-child{color:#a9b7c6}.token.url{color:#287bde;text-decoration:underline}.token.function{color:#ffc66d}.token.regex{background:#364135}.token.bold{font-weight:700}.token.italic{font-style:italic}.token.inserted{background:#294436}.token.deleted{background:#484a4a}code.language-css .token.property,code.language-css .token.property+.token.punctuation{color:#a9b7c6}code.language-css .token.id,code.language-css .token.selector>.token.attribute,code.language-css .token.selector>.token.class,code.language-css .token.selector>.token.pseudo-class,code.language-css .token.selector>.token.pseudo-element{color:#ffc66d}.command-line-prompt{border-right:1px solid #999;display:block;float:left;font-size:100%;letter-spacing:-1px;margin-right:1em;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.command-line-prompt>span:before{color:#999;content:" ";display:block;padding-right:.8em}.command-line-prompt>span[data-user]:before{content:"[" attr(data-user) "@" attr(data-host) "] $"}.command-line-prompt>span[data-user=root]:before{content:"[" attr(data-user) "@" attr(data-host) "] #"}.command-line-prompt>span[data-prompt]:before{content:attr(data-prompt)}</style><meta name="generator" content="Gatsby 3.4.1"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">svg:not(:root).svg-inline--fa {
  overflow: visible;
}

.svg-inline--fa {
  display: inline-block;
  font-size: inherit;
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.225em;
}
.svg-inline--fa.fa-w-1 {
  width: 0.0625em;
}
.svg-inline--fa.fa-w-2 {
  width: 0.125em;
}
.svg-inline--fa.fa-w-3 {
  width: 0.1875em;
}
.svg-inline--fa.fa-w-4 {
  width: 0.25em;
}
.svg-inline--fa.fa-w-5 {
  width: 0.3125em;
}
.svg-inline--fa.fa-w-6 {
  width: 0.375em;
}
.svg-inline--fa.fa-w-7 {
  width: 0.4375em;
}
.svg-inline--fa.fa-w-8 {
  width: 0.5em;
}
.svg-inline--fa.fa-w-9 {
  width: 0.5625em;
}
.svg-inline--fa.fa-w-10 {
  width: 0.625em;
}
.svg-inline--fa.fa-w-11 {
  width: 0.6875em;
}
.svg-inline--fa.fa-w-12 {
  width: 0.75em;
}
.svg-inline--fa.fa-w-13 {
  width: 0.8125em;
}
.svg-inline--fa.fa-w-14 {
  width: 0.875em;
}
.svg-inline--fa.fa-w-15 {
  width: 0.9375em;
}
.svg-inline--fa.fa-w-16 {
  width: 1em;
}
.svg-inline--fa.fa-w-17 {
  width: 1.0625em;
}
.svg-inline--fa.fa-w-18 {
  width: 1.125em;
}
.svg-inline--fa.fa-w-19 {
  width: 1.1875em;
}
.svg-inline--fa.fa-w-20 {
  width: 1.25em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-border {
  height: 1.5em;
}
.svg-inline--fa.fa-li {
  width: 2em;
}
.svg-inline--fa.fa-fw {
  width: 1.25em;
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter {
  background-color: #ff253a;
  border-radius: 1em;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  color: #fff;
  height: 1.5em;
  line-height: 1;
  max-width: 5em;
  min-width: 1.5em;
  overflow: hidden;
  padding: 0.25em;
  right: 0;
  text-overflow: ellipsis;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: 0;
  right: 0;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom right;
          transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: 0;
  left: 0;
  right: auto;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom left;
          transform-origin: bottom left;
}

.fa-layers-top-right {
  right: 0;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-top-left {
  left: 0;
  right: auto;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top left;
          transform-origin: top left;
}

.fa-lg {
  font-size: 1.3333333333em;
  line-height: 0.75em;
  vertical-align: -0.0667em;
}

.fa-xs {
  font-size: 0.75em;
}

.fa-sm {
  font-size: 0.875em;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: 2.5em;
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: -2em;
  position: absolute;
  text-align: center;
  width: 2em;
  line-height: inherit;
}

.fa-border {
  border: solid 0.08em #eee;
  border-radius: 0.1em;
  padding: 0.2em 0.25em 0.15em;
}

.fa-pull-left {
  float: left;
}

.fa-pull-right {
  float: right;
}

.fa.fa-pull-left,
.fas.fa-pull-left,
.far.fa-pull-left,
.fal.fa-pull-left,
.fab.fa-pull-left {
  margin-right: 0.3em;
}
.fa.fa-pull-right,
.fas.fa-pull-right,
.far.fa-pull-right,
.fal.fa-pull-right,
.fab.fa-pull-right {
  margin-left: 0.3em;
}

.fa-spin {
  -webkit-animation: fa-spin 2s infinite linear;
          animation: fa-spin 2s infinite linear;
}

.fa-pulse {
  -webkit-animation: fa-spin 1s infinite steps(8);
          animation: fa-spin 1s infinite steps(8);
}

@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}

@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";
  -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
}

.fa-rotate-180 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";
  -webkit-transform: rotate(180deg);
          transform: rotate(180deg);
}

.fa-rotate-270 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";
  -webkit-transform: rotate(270deg);
          transform: rotate(270deg);
}

.fa-flip-horizontal {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";
  -webkit-transform: scale(-1, 1);
          transform: scale(-1, 1);
}

.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(1, -1);
          transform: scale(1, -1);
}

.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(-1, -1);
          transform: scale(-1, -1);
}

:root .fa-rotate-90,
:root .fa-rotate-180,
:root .fa-rotate-270,
:root .fa-flip-horizontal,
:root .fa-flip-vertical,
:root .fa-flip-both {
  -webkit-filter: none;
          filter: none;
}

.fa-stack {
  display: inline-block;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: #fff;
}

.sr-only {
  border: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

.sr-only-focusable:active, .sr-only-focusable:focus {
  clip: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  position: static;
  width: auto;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse {
  color: #fff;
}</style><link rel="sitemap" type="application/xml" href="//sitemap-index.xml"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=aaf504cd191f8c5e9aa6f691529f4050" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=aaf504cd191f8c5e9aa6f691529f4050"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=aaf504cd191f8c5e9aa6f691529f4050"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=aaf504cd191f8c5e9aa6f691529f4050"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=aaf504cd191f8c5e9aa6f691529f4050"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=aaf504cd191f8c5e9aa6f691529f4050"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=aaf504cd191f8c5e9aa6f691529f4050"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=aaf504cd191f8c5e9aa6f691529f4050"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=aaf504cd191f8c5e9aa6f691529f4050"/><title data-react-helmet="true">SIP proxy server with Netty and SipStack | Konrad Drozd: Blog</title><meta data-react-helmet="true" name="description" content="In this post I will show you how to make a simple proxy server for SIP protocol.
Recently I spent some time with netty and decided to create some simple…"/><meta data-react-helmet="true" property="og:title" content="SIP proxy server with Netty and SipStack"/><meta data-react-helmet="true" property="og:description" content="In this post I will show you how to make a simple proxy server for SIP protocol.
Recently I spent some time with netty and decided to create some simple…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content=""/><meta data-react-helmet="true" name="twitter:title" content="SIP proxy server with Netty and SipStack"/><meta data-react-helmet="true" name="twitter:description" content="In this post I will show you how to make a simple proxy server for SIP protocol.
Recently I spent some time with netty and decided to create some simple…"/><link as="script" rel="preload" href="/webpack-runtime-cfd69c61caf676285c38.js"/><link as="script" rel="preload" href="/framework-a0275a8146aade7c3fca.js"/><link as="script" rel="preload" href="/app-d98e73955c33fd88eeda.js"/><link as="script" rel="preload" href="/a9a7754c-84717cf9e6591c2c5321.js"/><link as="script" rel="preload" href="/commons-16bf0c30a7860245d045.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-900fa5193ce448ea9d66.js"/><link as="fetch" rel="preload" href="/page-data/sip-proxy-with-netty-and-sipstack/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="h-full flex flex-col"><header class="p-2 flex text-lg justify-between border-b-2"><div class="flex"><a class="text-gray-800 hover:text-gray-900 py-2 px-4" href="/">kdrozd.pl</a></div><div class="flex"><a class="text-gray-800 hover:text-gray-900 py-2 px-4" href="/blog">Blog</a></div></header><main class="flex-1"><article class="m-auto px-2 md:w-128 border-b border-gray-400 text-justify" itemscope="" itemType="http://schema.org/Article"><header><h1 class=" font-semibold text-3xl mb-2 text-left" itemProp="headline">SIP proxy server with Netty and SipStack</h1><p class="mb-2 text-sm text-gray-600 leading-tight font-medium flex"><span class="pr-2 mr-2 border-r border-black">Konrad Drozd</span><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="calendar-alt" class="svg-inline--fa fa-calendar-alt fa-w-14 fa-lg pr-1 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"></path></svg>15 June 2021</p><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper w-full mb-4 max-h-96"><div aria-hidden="true" style="padding-top:66.70378619153675%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHdR1LCA//EABoQAAICAwAAAAAAAAAAAAAAAAABAhEQISL/2gAIAQEAAQUClZ1ihRoWl//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAAMAAwAAAAAAAAAAAAAAAAEQMQARIf/aAAgBAQAGPwLmUV0zS//EABwQAQEAAgIDAAAAAAAAAAAAAAERAEEQITFRYf/aAAgBAQABPyHoLBuzWWtHxrhtWpSZR5vZggWzP//aAAwDAQACAAMAAAAQM8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAdEAACAgMAAwAAAAAAAAAAAAABESFBADFhEHGh/9oACAEBAAE/EDGAAmTq8CbQImfre+/PBhVR1ucOwioiI9gbydSAGbz/2Q==" alt=""/><picture><source type="image/avif" data-srcset="/static/f7ce6b53d9404a990a7fe9291d72c140/b0356/featured.avif 750w,/static/f7ce6b53d9404a990a7fe9291d72c140/048e5/featured.avif 898w" sizes="100vw"/><source type="image/webp" data-srcset="/static/f7ce6b53d9404a990a7fe9291d72c140/57584/featured.webp 750w,/static/f7ce6b53d9404a990a7fe9291d72c140/9c270/featured.webp 898w" sizes="100vw"/><img data-gatsby-image-ssr="" class="w-full" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/f7ce6b53d9404a990a7fe9291d72c140/f3fc5/featured.jpg" data-srcset="/static/f7ce6b53d9404a990a7fe9291d72c140/7284f/featured.jpg 750w,/static/f7ce6b53d9404a990a7fe9291d72c140/f3fc5/featured.jpg 898w" alt="Front Picture"/></picture><noscript><picture><source type="image/avif" srcSet="/static/f7ce6b53d9404a990a7fe9291d72c140/b0356/featured.avif 750w,/static/f7ce6b53d9404a990a7fe9291d72c140/048e5/featured.avif 898w" sizes="100vw"/><source type="image/webp" srcSet="/static/f7ce6b53d9404a990a7fe9291d72c140/57584/featured.webp 750w,/static/f7ce6b53d9404a990a7fe9291d72c140/9c270/featured.webp 898w" sizes="100vw"/><img data-gatsby-image-ssr="" class="w-full" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/f7ce6b53d9404a990a7fe9291d72c140/f3fc5/featured.jpg" srcSet="/static/f7ce6b53d9404a990a7fe9291d72c140/7284f/featured.jpg 750w,/static/f7ce6b53d9404a990a7fe9291d72c140/f3fc5/featured.jpg 898w" alt="Front Picture"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div></header><section itemProp="articleBody"><p>In this post I will show you how to make a simple proxy server for SIP protocol.
Recently I spent some time with <a href="https://netty.io/" target="_blank" rel="nofollow noopener noreferrer">netty</a> and decided to create some simple application to solidify my knowledge.
I will use the <a href="https://www.sipstack.io/getstarted/" target="_blank" rel="nofollow noopener noreferrer">sipstack</a> library as a support for the SIP protocol (decoding, encoding…).
Actually, the protocol that I’ve used doesn’t matter so much, but web is full of HTTP proxies tutorials and I wanted to bring something new.</p>
<p>As always, you will find the final code <a href="github">on my github</a>.</p>
<h2>But why SIP? What is it anyway?</h2>
<p><a href="https://en.wikipedia.org/wiki/Session_Initiation_Protocol" target="_blank" rel="nofollow noopener noreferrer">SIP</a> stands for <em>Session Initiation Protocol</em>.
In simple words, this protocol is used to set up sessions between clients,
for example in IP telephony (<a href="https://en.wikipedia.org/wiki/Voice_over_IP" target="_blank" rel="nofollow noopener noreferrer">Voice over Internet Protocol</a>).
This is the protocol that we use when writing <a href="https://en.wikipedia.org/wiki/Value-added_service" target="_blank" rel="nofollow noopener noreferrer">value-added-services</a> in my current job.
An extremely simplified diagram of how this protocol works looks like this:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/fc64c37a9c81ce4c5b13a70179bbaff8/715a3/sip_flow.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 69.62025316455697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/ElEQVQ4y31Ty47TQBD0f/IBXLnzAVz5mOUMCHHZA6wSJNAui5M4kZ04fnvsedguVJ3MrkPQjtTqdrunprp6JpimCTRgwjA47NMjfO6UBx4eQ/xZbyT2OWOs1PqczweYLW1GfLxdwjn7lLPW4tXrN3j77r18j+eNedXg8+3iGtCpCLoOoZsQpo2w3yfywzkHY4zEh8MBrVLzs2GtQ3rMpLNpGs82IbBtiL56QFfewzaPMH0txXVdoyxLYdj3PcZxlEOYG4YBzlqcSV2swNW/oLIF+mIJV9/D6Ab/1pFp13VQSiHPc/Fdp9EUG+hiiS7/gS5fQFe/EdjiO8r4C+rkK2zxDVW+hbEOx2OK3W4n7AjQtq2AhWEoXpsB7fEnqugG+foDis0NmvjT5VDITKlOGFG3OI6FGUGZo2+aRjxlYTeDyWH7DFZnGEyBYH5FaNSMehGIxpgAforUz092/J+G85HTeyBvZHbSbK5hi6qq5FumPA7PU55fVj/FLMtkIy2KIvFFUQgAa1lH67W5YHcFyHa01lLMmOySJMF2u8VqtRJNyUzrHlpbtGUkt0Nld7Bqd/1SuNgadSSjNE1FQx5CcB5ClvyvjYHpcli1hW7WcH36DDjX0OvFtgnImDIQlFfH506HuJdblsmN49XkmJPXcX6OjMny9Oanp4GQ4V/VuD06A+5ZcwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Simple SIP flow"
        title="Open image"
        src="/static/fc64c37a9c81ce4c5b13a70179bbaff8/f058b/sip_flow.png"
        srcset="/static/fc64c37a9c81ce4c5b13a70179bbaff8/c26ae/sip_flow.png 158w,
/static/fc64c37a9c81ce4c5b13a70179bbaff8/6bdcf/sip_flow.png 315w,
/static/fc64c37a9c81ce4c5b13a70179bbaff8/f058b/sip_flow.png 630w,
/static/fc64c37a9c81ce4c5b13a70179bbaff8/715a3/sip_flow.png 830w"
        sizes="(max-width: 630px) 100vw, 630px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>I chose this protocol in order to expand my competences.
Perhaps, in addition to learning, this playground will be useful for something at work :)</p>
<h2>Objective</h2>
<p>The application will work exactly as shown in the diagram above.
Messages will be sent without making any changes to them. This will be a so-called <a href="https://www.tutorialspoint.com/session_initiation_protocol/session_initiation_protocol_proxies_and_routing.htm" target="_blank" rel="nofollow noopener noreferrer">stateless proxy</a>.</p>
<blockquote>
<p>Stateless proxies forget about the SIP request once it has been forwarded. This kind of server does not store any information of the call or transaction.</p>
</blockquote>
<p>Information about who is the addressee of the message will be included in the <code class="language-text">Route</code> header.</p>
<p><strong>Technologies used:</strong></p>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://netty.io/" target="_blank" rel="nofollow noopener noreferrer">Netty</a></td>
</tr>
<tr>
<td><a href="https://www.sipstack.io/getstarted/" target="_blank" rel="nofollow noopener noreferrer">SipStack</a></td>
</tr>
<tr>
<td><a href="https://github.com/SIPp/sipp" target="_blank" rel="nofollow noopener noreferrer">SIPp</a> (for functional testing)</td>
</tr>
<tr>
<td><a href="https://kotlinlang.org/" target="_blank" rel="nofollow noopener noreferrer">Kotlin</a> (as part of learning 😊)</td>
</tr>
<tr>
<td><a href="https://gradle.org/" target="_blank" rel="nofollow noopener noreferrer">Gradle</a></td>
</tr>
</tbody>
</table>
<h2>Project setup</h2>
<p>I started from generating a <em>hello-world</em> template using IntelliJ and added the necessary dependencies:</p>
<div class="gatsby-highlight" data-language="gradle"><pre style="counter-reset: linenumber NaN" class="language-gradle line-numbers"><code class="language-gradle">dependencies {
//    SIP support
    implementation(&quot;io.sipstack:sipstack-netty-codec-sip:0.1.1&quot;)
    
//    logging
    implementation(&quot;org.slf4j:slf4j-api:1.7.30&quot;)
    implementation(&quot;ch.qos.logback:logback-classic:1.2.3&quot;)
    implementation(&quot;ch.qos.logback:logback-core:1.2.3&quot;)
}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Set up netty server</h2>
<p>Then I created a main class <code class="language-text">ProxyApp</code> that runs the netty server.</p>
<p>In the code I took the following nomenclature:</p>
<ul>
<li><code class="language-text">upstream</code> - this is where the messages originally come (Bob)</li>
<li><code class="language-text">downstream</code> - this is where the messages are proxied (Alice)</li>
</ul>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">package</span> pl<span class="token punctuation">.</span>kdrozd<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>sipproxy

<span class="token keyword">import</span> io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span>ServerBootstrap
<span class="token keyword">import</span> io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>Channel
<span class="token keyword">import</span> io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>ChannelInitializer
<span class="token keyword">import</span> io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>NioEventLoopGroup
<span class="token keyword">import</span> io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>NioServerSocketChannel
<span class="token keyword">import</span> io<span class="token punctuation">.</span>sipstack<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>sip<span class="token punctuation">.</span>SipMessageEncoder
<span class="token keyword">import</span> io<span class="token punctuation">.</span>sipstack<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>sip<span class="token punctuation">.</span>SipMessageStreamDecoder
<span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>LoggerFactory
<span class="token keyword">import</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>InetSocketAddress

<span class="token keyword">class</span> <span class="token function">ProxyApp</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> hostname<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">private</span> <span class="token keyword">val</span> port<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">var</span> upstreamChannel<span class="token operator">:</span> Channel<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token keyword">fun</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> workGroup <span class="token operator">=</span> <span class="token function">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> bossGroup <span class="token operator">=</span> <span class="token function">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> b <span class="token operator">=</span> <span class="token function">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        b<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workGroup<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span>NioServerSocketChannel<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">object</span> <span class="token operator">:</span> ChannelInitializer<span class="token operator">&lt;</span>Channel<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">initChannel</span><span class="token punctuation">(</span>ch<span class="token operator">:</span> Channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">with</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">"decoder"</span><span class="token punctuation">,</span> <span class="token function">SipMessageStreamDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">"encoder"</span><span class="token punctuation">,</span> <span class="token function">SipMessageEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> socketAddress <span class="token operator">=</span> <span class="token function">InetSocketAddress</span><span class="token punctuation">(</span>hostname<span class="token punctuation">,</span> port<span class="token punctuation">)</span>
        <span class="token keyword">val</span> f <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>socketAddress<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        upstreamChannel <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>upstreamChannel<span class="token operator">?</span><span class="token punctuation">.</span>isActive <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            upstreamChannel<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>This class is not very interesting and looks like most of the other classes that bootstrap netty.
We use <code class="language-text">NioServerSocketChannel</code>, because we want to use <code class="language-text">TCP</code> protocol.
In the case of <code class="language-text">UDP</code>, we would use <code class="language-text">NioDatagramChannel</code>.
If you need more explanation of what’s going on here, check out <a href="https://netty.io/wiki/user-guide-for-4.x.html#writing-a-discard-server" target="_blank" rel="nofollow noopener noreferrer">the netty documentation</a>. </p>
<p>The most interesting part is setting up the message decoder/encoder:</p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin">b<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workGroup<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span>NioServerSocketChannel<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">object</span> <span class="token operator">:</span> ChannelInitializer<span class="token operator">&lt;</span>Channel<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">initChannel</span><span class="token punctuation">(</span>ch<span class="token operator">:</span> Channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">with</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">"decoder"</span><span class="token punctuation">,</span> <span class="token function">SipMessageStreamDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">"encoder"</span><span class="token punctuation">,</span> <span class="token function">SipMessageEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><code class="language-text">SipMessageStreamDecoder</code> is the decoder for the incoming data. It decodes bytes to <code class="language-text">SipMessageEvent</code> and works for stream based protocols (TCP).
If you want to use datagram based protocols (UDP), there is an alternative: <code class="language-text">SipMessageDatagramDecoder</code>.</p>
<p><code class="language-text">SipMessageEncoder</code> encodes <code class="language-text">SipMessageEvent</code> back to bytes. It is used for both TCP and UDP.</p>
<p>With a simple <code class="language-text">main</code> method we can run the service:</p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">package</span> pl<span class="token punctuation">.</span>kdrozd<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>sipproxy

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> app <span class="token operator">=</span> <span class="token function">ProxyApp</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">5060</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Create handlers</h2>
<p>After startup, our server is able to accept messages,
but we haven’t added any message handler to the pipeline, so it doesn’t do anything with them.</p>
<p>Below is the <strong><code class="language-text">ProxyUpstreamHandler</code></strong> implementation.
This is the handler responsible for receiving messages from <code class="language-text">upstream</code>, creating connection with <code class="language-text">downstream</code> and proxying the messages.</p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">package</span> pl<span class="token punctuation">.</span>kdrozd<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>sipproxy

<span class="token keyword">import</span> io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span>Bootstrap
<span class="token keyword">import</span> io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span>Unpooled
<span class="token keyword">import</span> io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>NioSocketChannel
<span class="token keyword">import</span> io<span class="token punctuation">.</span>pkts<span class="token punctuation">.</span>packet<span class="token punctuation">.</span>sip<span class="token punctuation">.</span>SipMessage
<span class="token keyword">import</span> io<span class="token punctuation">.</span>pkts<span class="token punctuation">.</span>packet<span class="token punctuation">.</span>sip<span class="token punctuation">.</span>address<span class="token punctuation">.</span>SipURI
<span class="token keyword">import</span> io<span class="token punctuation">.</span>sipstack<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>sip<span class="token punctuation">.</span>SipMessageEncoder
<span class="token keyword">import</span> io<span class="token punctuation">.</span>sipstack<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>sip<span class="token punctuation">.</span>SipMessageEvent
<span class="token keyword">import</span> io<span class="token punctuation">.</span>sipstack<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>sip<span class="token punctuation">.</span>SipMessageStreamDecoder
<span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>LoggerFactory

<span class="token keyword">class</span> ProxyUpstreamHandler <span class="token operator">:</span> SimpleChannelInboundHandler<span class="token operator">&lt;</span>SipMessageEvent<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 1</span>

    <span class="token keyword">private</span> <span class="token keyword">var</span> downstreamChannel<span class="token operator">:</span> Channel<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span> <span class="token comment">// 2</span>
        ctx<span class="token operator">:</span> ChannelHandlerContext<span class="token punctuation">,</span>
        event<span class="token operator">:</span> SipMessageEvent
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> msg <span class="token operator">=</span> event<span class="token punctuation">.</span>message
        <span class="token keyword">val</span> upstreamChannel<span class="token operator">:</span> Channel <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">val</span> f<span class="token operator">:</span> ChannelFuture <span class="token operator">=</span> <span class="token function">connectWithDownstream</span><span class="token punctuation">(</span>upstreamChannel<span class="token punctuation">,</span> msg<span class="token punctuation">)</span> <span class="token comment">// 3</span>

        f<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>ChannelFutureListener <span class="token punctuation">{</span> connectionCompleteFuture<span class="token operator">:</span> ChannelFuture <span class="token operator">-></span> <span class="token comment">// 4</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>connectionCompleteFuture<span class="token punctuation">.</span>isSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">closeAndFlush</span><span class="token punctuation">(</span>upstreamChannel<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            downstreamChannel <span class="token operator">=</span> connectionCompleteFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">proxyMessageToDownstream</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">connectWithDownstream</span><span class="token punctuation">(</span>
        upstreamChannel<span class="token operator">:</span> Channel<span class="token punctuation">,</span>
        msg<span class="token operator">:</span> SipMessage
    <span class="token punctuation">)</span><span class="token operator">:</span> ChannelFuture <span class="token punctuation">{</span>
        <span class="token keyword">val</span> b <span class="token operator">=</span> <span class="token function">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        b<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>upstreamChannel<span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span>NioSocketChannel<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">object</span> <span class="token operator">:</span> ChannelInitializer<span class="token operator">&lt;</span>Channel<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">initChannel</span><span class="token punctuation">(</span>ch<span class="token operator">:</span> Channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">with</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">"decoder"</span><span class="token punctuation">,</span> <span class="token function">SipMessageStreamDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">"encoder"</span><span class="token punctuation">,</span> <span class="token function">SipMessageEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">"handler"</span><span class="token punctuation">,</span> <span class="token function">ProxyDownstreamHandler</span><span class="token punctuation">(</span>upstreamChannel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> routeHeader <span class="token operator">=</span> msg<span class="token punctuation">.</span>routeHeader<span class="token punctuation">.</span>address<span class="token punctuation">.</span>uri <span class="token keyword">as</span> SipURI <span class="token comment">// 6</span>
        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>routeHeader<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> routeHeader<span class="token punctuation">.</span>port<span class="token punctuation">)</span> <span class="token comment">// 7</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">proxyMessageToDownstream</span><span class="token punctuation">(</span>ctx<span class="token operator">:</span> ChannelHandlerContext<span class="token punctuation">,</span> msg<span class="token operator">:</span> SipMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        downstreamChannel<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>
            ChannelFutureListener <span class="token punctuation">{</span> messageProxiedFuture<span class="token operator">:</span> ChannelFuture <span class="token operator">-></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>messageProxiedFuture<span class="token punctuation">.</span>isSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">closeAndFlush</span><span class="token punctuation">(</span>messageProxiedFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span>ctx<span class="token operator">:</span> ChannelHandlerContext<span class="token punctuation">,</span> cause<span class="token operator">:</span> Throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 8</span>
        cause<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">closeAndFlush</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>

        <span class="token keyword">fun</span> <span class="token function">closeAndFlush</span><span class="token punctuation">(</span>ch<span class="token operator">:</span> Channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ch<span class="token punctuation">.</span>isActive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ch<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>Unpooled<span class="token punctuation">.</span>EMPTY_BUFFER<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>ChannelFutureListener<span class="token punctuation">.</span>CLOSE<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>This class is a bit more complicated, so I will try to describe the most important parts:</p>
<ol>
<li>Since <code class="language-text">SipMessageStreamDecoder</code> decodes bytes to <code class="language-text">SipMessageEvent</code> we need our handler to operate with this class.
That’s why we extend the <code class="language-text">SimpleChannelInboundHandler&lt;SipMessageEvent&gt;</code> class.</li>
<li><code class="language-text">channelRead0</code> method is called whenever new data is received from client.
Thanks to the fact that we extend the <code class="language-text">SimpleChannelInboundHandler&lt;SipMessageEvent&gt;</code> class, as an input we get a decoded <code class="language-text">SipMessageEvent</code>.</li>
<li>We set up a connection between proxy server and the destination. The setup is very similar to the one from <code class="language-text">ProxyApp</code> class.</li>
<li>As soon as the connection is established, we want to send a message to the destination,
that is why we set up a listener. If anything goes wrong with the connection or message transfer, we just close the channel.</li>
<li><code class="language-text">ProxyDownstreamHandler</code> is a handler for messages that come from the destination. I will describe it later.</li>
<li>Here, we try to read the destination address from <code class="language-text">Route</code> header.
I could use some security in case this header is not defined, but I don’t want to complicate the code.</li>
<li>Here, the connection is started.</li>
<li>If we get an exception along the way, we also just close the channel.</li>
</ol>
<p><strong><code class="language-text">ProxyDownstreamHandler</code></strong> is much simplier.
Any message that arrives is simply sent to the upstream channel.
If the <code class="language-text">server &lt;-&gt; downstream</code> channel is deactivated, we close the <code class="language-text">server &lt;-&gt; upstream</code> channel as well.
As before, in case of any failure/exception, we close the channel.</p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">package</span> pl<span class="token punctuation">.</span>kdrozd<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>sipproxy

<span class="token keyword">import</span> io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> io<span class="token punctuation">.</span>sipstack<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>sip<span class="token punctuation">.</span>SipMessageEvent
<span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>LoggerFactory
<span class="token keyword">import</span> pl<span class="token punctuation">.</span>kdrozd<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>sipproxy<span class="token punctuation">.</span>ProxyUpstreamHandler<span class="token punctuation">.</span>Companion<span class="token punctuation">.</span>closeAndFlush

<span class="token keyword">class</span> <span class="token function">ProxyDownstreamHandler</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> upstreamChannel<span class="token operator">:</span> Channel<span class="token punctuation">)</span> <span class="token operator">:</span> SimpleChannelInboundHandler<span class="token operator">&lt;</span>SipMessageEvent<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span>ctx<span class="token operator">:</span> ChannelHandlerContext<span class="token punctuation">,</span> event<span class="token operator">:</span> SipMessageEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> msg <span class="token operator">=</span> event<span class="token punctuation">.</span>message
        
        upstreamChannel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>ChannelFutureListener <span class="token punctuation">{</span> future<span class="token operator">:</span> ChannelFuture <span class="token operator">-></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>future<span class="token punctuation">.</span>isSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">closeAndFlush</span><span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">channelInactive</span><span class="token punctuation">(</span>ctx<span class="token operator">:</span> ChannelHandlerContext<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">closeAndFlush</span><span class="token punctuation">(</span>upstreamChannel<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span>ctx<span class="token operator">:</span> ChannelHandlerContext<span class="token punctuation">,</span> cause<span class="token operator">:</span> Throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cause<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">closeAndFlush</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>These are all the elements we need for our proxy to work.
The last step is to add the <code class="language-text">ProxyUpstreamHandler</code> to the pipeline in the <code class="language-text">ProxyApp</code> class:</p>
<div class="gatsby-highlight" data-language="kotlin"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin">b<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workGroup<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span>NioServerSocketChannel<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">object</span> <span class="token operator">:</span> ChannelInitializer<span class="token operator">&lt;</span>Channel<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">initChannel</span><span class="token punctuation">(</span>ch<span class="token operator">:</span> Channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">with</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">"decoder"</span><span class="token punctuation">,</span> <span class="token function">SipMessageStreamDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">"encoder"</span><span class="token punctuation">,</span> <span class="token function">SipMessageEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token string">"handler"</span><span class="token punctuation">,</span> <span class="token function">ProxyUpstreamHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &lt;----</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Create a test</h2>
<p>To test the proxy I will use <a href="https://github.com/SIPp/sipp" target="_blank" rel="nofollow noopener noreferrer">the SIPp</a> application.
It allows to create <code class="language-text">XML</code> scenarios and send <code class="language-text">SIP</code> messages.
I’d say it is <a href="https://www.postman.com/" target="_blank" rel="nofollow noopener noreferrer">the Postman</a> equivalent for SIP protocol.</p>
<p>The test case will look exactly the same as the connection between Bob and Alice at the beginning of the post:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/fc64c37a9c81ce4c5b13a70179bbaff8/715a3/sip_flow.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 69.62025316455697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/ElEQVQ4y31Ty47TQBD0f/IBXLnzAVz5mOUMCHHZA6wSJNAui5M4kZ04fnvsedguVJ3MrkPQjtTqdrunprp6JpimCTRgwjA47NMjfO6UBx4eQ/xZbyT2OWOs1PqczweYLW1GfLxdwjn7lLPW4tXrN3j77r18j+eNedXg8+3iGtCpCLoOoZsQpo2w3yfywzkHY4zEh8MBrVLzs2GtQ3rMpLNpGs82IbBtiL56QFfewzaPMH0txXVdoyxLYdj3PcZxlEOYG4YBzlqcSV2swNW/oLIF+mIJV9/D6Ab/1pFp13VQSiHPc/Fdp9EUG+hiiS7/gS5fQFe/EdjiO8r4C+rkK2zxDVW+hbEOx2OK3W4n7AjQtq2AhWEoXpsB7fEnqugG+foDis0NmvjT5VDITKlOGFG3OI6FGUGZo2+aRjxlYTeDyWH7DFZnGEyBYH5FaNSMehGIxpgAforUz092/J+G85HTeyBvZHbSbK5hi6qq5FumPA7PU55fVj/FLMtkIy2KIvFFUQgAa1lH67W5YHcFyHa01lLMmOySJMF2u8VqtRJNyUzrHlpbtGUkt0Nld7Bqd/1SuNgadSSjNE1FQx5CcB5ClvyvjYHpcli1hW7WcH36DDjX0OvFtgnImDIQlFfH506HuJdblsmN49XkmJPXcX6OjMny9Oanp4GQ4V/VuD06A+5ZcwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Simple SIP flow"
        title="Open image"
        src="/static/fc64c37a9c81ce4c5b13a70179bbaff8/f058b/sip_flow.png"
        srcset="/static/fc64c37a9c81ce4c5b13a70179bbaff8/c26ae/sip_flow.png 158w,
/static/fc64c37a9c81ce4c5b13a70179bbaff8/6bdcf/sip_flow.png 315w,
/static/fc64c37a9c81ce4c5b13a70179bbaff8/f058b/sip_flow.png 630w,
/static/fc64c37a9c81ce4c5b13a70179bbaff8/715a3/sip_flow.png 830w"
        sizes="(max-width: 630px) 100vw, 630px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>For this purpose, I defined the two scenarios:</p>
<div class="gatsby-highlight" data-language="xml"><pre style="counter-reset: linenumber NaN" class="language-xml line-numbers"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="ISO-8859-1" ?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">scenario</span> <span class="token name">SYSTEM</span> <span class="token string">"sipp.dtd"</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scenario</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Bob<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>send</span> <span class="token attr-name">retrans</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token cdata">&lt;![CDATA[

      INVITE sip:[service]@[remote_ip]:[remote_port] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      From: sipp &lt;sip:sipp@[local_ip]:[local_port]>;tag=[pid]SIPpTag00[call_number]
      To: [service] &lt;sip:[service]@[remote_ip]:[remote_port]>
      Call-ID: [call_id]
      CSeq: 1 INVITE
      Route: &lt;sip:127.0.0.1:[alices_port];transport=[transport];lr>
      Contact: sip:sipp@[local_ip]:[local_port]
      Max-Forwards: 70
      Content-Type: application/sdp
      Content-Length: 0

    ]]></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>send</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recv</span> <span class="token attr-name">response</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>180<span class="token punctuation">"</span></span> <span class="token attr-name">optional</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recv</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recv</span> <span class="token attr-name">response</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span> <span class="token attr-name">rtd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recv</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>send</span><span class="token punctuation">></span></span>
        <span class="token cdata">&lt;![CDATA[
      ACK sip:[service]@[remote_ip]:[remote_port] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      From: sipp &lt;sip:sipp@[local_ip]:[local_port]>;tag=[pid]SIPpTag00[call_number]
      To: [service] &lt;sip:[service]@[remote_ip]:[remote_port]>[peer_tag_param]
      Route: &lt;sip:127.0.0.1:[alices_port];transport=[transport];lr>
      Call-ID: [call_id]
      CSeq: 1 ACK
      Contact: sip:sipp@[local_ip]:[local_port]
      Max-Forwards: 70
      Content-Length: 0
    ]]></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>send</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recv</span> <span class="token attr-name">request</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BYE<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recv</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>send</span><span class="token punctuation">></span></span>
        <span class="token cdata">&lt;![CDATA[

      SIP/2.0 200 OK
      [last_Via:]
      [last_From:]
      [last_To:]
      [last_Call-ID:]
      [last_CSeq:]
      Route: &lt;sip:127.0.0.1:[alices_port];transport=[transport];lr>
      Contact: &lt;sip:[local_ip]:[local_port];transport=[transport]>
      Content-Length: 0

    ]]></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>send</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scenario</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<div class="gatsby-highlight" data-language="xml"><pre style="counter-reset: linenumber NaN" class="language-xml line-numbers"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="ISO-8859-1" ?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">scenario</span> <span class="token name">SYSTEM</span> <span class="token string">"sipp.dtd"</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scenario</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Alice<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                                      -->
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recv</span> <span class="token attr-name">request</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INVITE<span class="token punctuation">"</span></span> <span class="token attr-name">crlf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recv</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>send</span><span class="token punctuation">></span></span>
        <span class="token cdata">&lt;![CDATA[

      SIP/2.0 180 Ringing
      [last_Via:]
      [last_From:]
      [last_To:];tag=[pid]SIPpTag01[call_number]
      [last_Call-ID:]
      [last_CSeq:]
      Contact: &lt;sip:[local_ip]:[local_port];transport=[transport]>
      Content-Length: 0

    ]]></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>send</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pause</span> <span class="token attr-name">milliseconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3000<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>send</span> <span class="token attr-name">retrans</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token cdata">&lt;![CDATA[

      SIP/2.0 200 OK
      [last_Via:]
      [last_From:]
      [last_To:];tag=[pid]SIPpTag01[call_number]
      [last_Call-ID:]
      [last_CSeq:]
      Contact: &lt;sip:[local_ip]:[local_port];transport=[transport]>
      Content-Type: application/sdp
      Content-Length: 0

    ]]></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>send</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recv</span> <span class="token attr-name">request</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ACK<span class="token punctuation">"</span></span>
          <span class="token attr-name">rtd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
          <span class="token attr-name">crlf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recv</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pause</span> <span class="token attr-name">milliseconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3000<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>send</span> <span class="token attr-name">retrans</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token cdata">&lt;![CDATA[
      BYE sip:[service]@[remote_ip]:[remote_port] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      From: sipp &lt;sip:sipp@[local_ip]:[local_port]>;tag=[pid]SIPpTag00[call_number]
      To: [service] &lt;sip:[service]@[remote_ip]:[remote_port]>[peer_tag_param]
      Call-ID: [call_id]
      CSeq: 2 BYE
      Contact: sip:sipp@[local_ip]:[local_port]
      Max-Forwards: 70
      Subject: Performance Test
      Content-Length: 0
    ]]></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>send</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recv</span> <span class="token attr-name">response</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span> <span class="token attr-name">crlf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recv</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scenario</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>and launch script:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token comment"># Kill any existing sipp processes</span>
<span class="token function">pkill</span> sipp

<span class="token comment"># Start Alice's agent in background</span>
sipp <span class="token number">127.0</span>.0.1:5060 -sf alice.xml -t t1 -m <span class="token number">1</span> -bg -trace_screen

<span class="token comment"># Get the Alice's agent port (quite naive, I do not recommend using it in real tests)</span>
<span class="token assign-left variable">ALICES_PORT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">sudo</span>  <span class="token function">netstat</span> -ltnp <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"/sipp"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{ print <span class="token variable">$4</span> }'</span> <span class="token operator">|</span>  <span class="token function">grep</span> -o <span class="token string">"[^:]*$"</span><span class="token variable">)</span></span>

<span class="token comment"># Start Bob's agent</span>
sipp <span class="token number">127.0</span>.0.1:5060 -sf bob.xml -t t1 -m <span class="token number">1</span> -key alices_port <span class="token variable">${ALICES_PORT}</span> -trace_screen</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Short description of <code class="language-text">sipp</code> parameters:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="language-text">-sf</code></td>
<td>scenario file</td>
</tr>
<tr>
<td><code class="language-text">-t t1</code></td>
<td>use TCP</td>
</tr>
<tr>
<td><code class="language-text">-m1</code></td>
<td>perform 1 call</td>
</tr>
<tr>
<td><code class="language-text">-key alices_port ${ALICES_PORT}</code></td>
<td>set a key that will be available in the <code class="language-text">XML</code> scenario as <code class="language-text">[alices_port]</code></td>
</tr>
<tr>
<td>-trace_screen</td>
<td>generate a file with agent’s messages flow</td>
</tr>
</tbody>
</table>
<h2>Run the test</h2>
<p>You need to install the <code class="language-text">SIPp</code> application to run the test.
And if you did, just:</p>
<ol>
<li>Run the proxy service from <code class="language-text">main</code> method.</li>
<li>Run the test shell script</li>
</ol>
<p>Both agents should generate <code class="language-text">*_screen.log</code> files with output similiar to this one:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">------------------------------ Scenario Screen -------- [1-9]: Change Screen --
  Call rate (length)   Port   Total-time  Total-calls  Remote-host
  10.0(0 ms)/1.000s   5062       6.23 s            1  127.0.0.1:5060(TCP)

  Call limit 1 hit, 0.0 s period          0 ms scheduler resolution            
  0 calls (limit 30)                      Peak was 1 calls, after 0 s
  0 Running, 3 Paused, 0 Woken up
  0 dead call msg (discarded)             0 out-of-call msg (discarded)
  0 open sockets                          0/0/0 TCP errors (send/recv/cong)

                                 Messages  Retrans   Timeout   Unexpected-Msg
      INVITE ----------&gt;         1         0         0                         
         180 &lt;----------         1         0         0         0               
         200 &lt;----------  E-RTD1 1         0         0         0               
         ACK ----------&gt;         1         0                                   
         BYE &lt;----------         1         0         0         0               
         200 ----------&gt;         1         0                                   
------- Waiting for active calls to end. Press [q] again to force exit. -------
----------------------------- Statistics Screen ------- [1-9]: Change Screen --
  Start Time             | 2021-06-16	17:45:29.353922	1625237129.353922         
  Last Reset Time        | 2021-06-16	17:45:35.591290	1625237135.591290         
  Current Time           | 2021-06-16	17:45:35.591325	1625237135.591325         
-------------------------+---------------------------+--------------------------
  Incoming calls created |        0                  |        0                 
  Outgoing calls created |        0                  |        1                 
  Total Calls created    |                           |        1                 
-------------------------+---------------------------+--------------------------
  Successful call        |        0                  |        1                 
  Failed call            |        0                  |        0                 
-------------------------+---------------------------+--------------------------
  Response Time 1        | 00:00:00:000000           | 00:00:00:000000          
  Call Length            | 00:00:00:000000           | 00:00:00:000000          </code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>And if you still don’t believe it works, you can run <a href="https://www.wireshark.org/" target="_blank" rel="nofollow noopener noreferrer">wireshark</a>
with a <code class="language-text">sip</code> filter before the test and check the captured packets.</p>
<h2>Summary</h2>
<p>In the above article I showed you how to create a SIP proxy service based on a <a href="https://www.sipstack.io/getstarted/" target="_blank" rel="nofollow noopener noreferrer">sipstack</a> library and <a href="https://netty.io/" target="_blank" rel="nofollow noopener noreferrer">netty</a> server.
This example is very simple and not entirely correct (more on that below), so I would rather not use it in serious systems 😊.
After all, during the writing of this article, I learned a lot and I hope that you will also find it useful.</p>
<p>I remind you that all the code can be found <a href="https://github.com/kkdrz/blog-examples/tree/main/sip-proxy-with-netty" target="_blank" rel="nofollow noopener noreferrer">on my github</a>.</p>
<h3>What can be improved</h3>
<h4>The routing logic</h4>
<p>The solution I have presented is not entirely compatible with how the SIP protocol works.
In fact, requests (<code class="language-text">INVITE</code>, <code class="language-text">ACK</code>, <code class="language-text">BYE</code>) can be based on the <code class="language-text">Route</code> header,
but after receiving such a message, the server should add the <code class="language-text">Via</code> header with its address.
The <code class="language-text">Via</code> headers are used for responses to find their way back the exact same path as the request took.
So each element in the network that processed this request should add it’s <code class="language-text">Via</code> header (sometimes there are exceptions to this rule).</p>
<p>So when the server receives a response, it should check if it’s address is in the latest <code class="language-text">Via</code> header.
Then it should delete this header and forward the message to the address that it found in the next <code class="language-text">Via</code> header.</p></section></article><div class="mt-4 m-auto px-2 pb-4 md:w-128"><h3>Other articles:</h3><div class="justify-around flex flex-col"><div class="mb-2"><a class="hover:no-underline" href="/custom-annotation-processor/"><div class="max-w-md mx-auto bg-white shadow-md hover:shadow-xl transition duration-200 ease-in-out overflow-hidden md:max-w-2xl"><div class="md:flex"><div class="md:flex-shrink-0 "><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper h-full w-full object-cover md:w-72"><div aria-hidden="true" style="padding-top:66.66666666666666%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHtJfMMWD//xAAbEAADAAIDAAAAAAAAAAAAAAABAgMABBESIf/aAAgBAQABBQI+tavQRYmfGPrpR1UKP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EAB0QAAIBBAMAAAAAAAAAAAAAAAABEQIQEkEyYWL/2gAIAQEABj8CR60LPlu2VUvohI//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhQTFR/9oACAEBAAE/ISoFzlwHD2Yj8iDbtQjmfWSjoJ//2gAMAwEAAgADAAAAEIAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAAIDAQEBAAAAAAAAAAAAAQARITFBYXGx/9oACAEBAAE/EDpjkgc9rcTscrTLofkQGslCgb1jypqCHkZ9jQvzhgz4T//Z" alt=""/><picture><source type="image/avif" data-srcset="/static/b4f15350cd052a82cd4210a5938ef13e/b0356/featured.avif 750w,/static/b4f15350cd052a82cd4210a5938ef13e/48f75/featured.avif 1080w,/static/b4f15350cd052a82cd4210a5938ef13e/a5094/featured.avif 1366w,/static/b4f15350cd052a82cd4210a5938ef13e/f46cf/featured.avif 1920w" sizes="100vw"/><source type="image/webp" data-srcset="/static/b4f15350cd052a82cd4210a5938ef13e/57584/featured.webp 750w,/static/b4f15350cd052a82cd4210a5938ef13e/984df/featured.webp 1080w,/static/b4f15350cd052a82cd4210a5938ef13e/4a276/featured.webp 1366w,/static/b4f15350cd052a82cd4210a5938ef13e/9c00f/featured.webp 1920w" sizes="100vw"/><img data-gatsby-image-ssr="" class="h-full w-full object-cover md:w-72" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/b4f15350cd052a82cd4210a5938ef13e/5267c/featured.jpg" data-srcset="/static/b4f15350cd052a82cd4210a5938ef13e/7284f/featured.jpg 750w,/static/b4f15350cd052a82cd4210a5938ef13e/29ba9/featured.jpg 1080w,/static/b4f15350cd052a82cd4210a5938ef13e/c8896/featured.jpg 1366w,/static/b4f15350cd052a82cd4210a5938ef13e/5267c/featured.jpg 1920w" alt="Front Picture"/></picture><noscript><picture><source type="image/avif" srcSet="/static/b4f15350cd052a82cd4210a5938ef13e/b0356/featured.avif 750w,/static/b4f15350cd052a82cd4210a5938ef13e/48f75/featured.avif 1080w,/static/b4f15350cd052a82cd4210a5938ef13e/a5094/featured.avif 1366w,/static/b4f15350cd052a82cd4210a5938ef13e/f46cf/featured.avif 1920w" sizes="100vw"/><source type="image/webp" srcSet="/static/b4f15350cd052a82cd4210a5938ef13e/57584/featured.webp 750w,/static/b4f15350cd052a82cd4210a5938ef13e/984df/featured.webp 1080w,/static/b4f15350cd052a82cd4210a5938ef13e/4a276/featured.webp 1366w,/static/b4f15350cd052a82cd4210a5938ef13e/9c00f/featured.webp 1920w" sizes="100vw"/><img data-gatsby-image-ssr="" class="h-full w-full object-cover md:w-72" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/b4f15350cd052a82cd4210a5938ef13e/5267c/featured.jpg" srcSet="/static/b4f15350cd052a82cd4210a5938ef13e/7284f/featured.jpg 750w,/static/b4f15350cd052a82cd4210a5938ef13e/29ba9/featured.jpg 1080w,/static/b4f15350cd052a82cd4210a5938ef13e/c8896/featured.jpg 1366w,/static/b4f15350cd052a82cd4210a5938ef13e/5267c/featured.jpg 1920w" alt="Front Picture"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div></div><div class="p-3"><div class="uppercase tracking-wide font-semibold text-gray-700">Custom Annotation Processor</div><div class="block mt-1 text-sm text-gray-600 leading-tight font-medium ">11 May 2021</div><p class="mt-2 text-gray-500">In this post I will show you how to make a simple proxy server for SIP protocol.
Recently I spent some time with netty and decided to create some simple…</p></div></div></div></a></div><div class="mb-2"><a class="hover:no-underline" href="/map-of-localities-matching-the-pattern/"><div class="max-w-md mx-auto bg-white shadow-md hover:shadow-xl transition duration-200 ease-in-out overflow-hidden md:max-w-2xl"><div class="md:flex"><div class="md:flex-shrink-0 "><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper h-full w-full object-cover md:w-72"><div aria-hidden="true" style="padding-top:66.48721399730822%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACIklEQVQ4y32T22sTURDG94/zwaf6JEW0Dwq+tCDGC6VKoIrQihZC7UOrKAZEUCxiQYTe8ILVitKQik129yRNk6ppLpvsZpNmN7s/2U03jYn2g8OcMzDffHNmRnJdFw+e9Y/TIvAFcFstXMdp2+Duna7YAFKvI4CtFbG/vMUt5TkKvaRSx+FlLBdwNtbYf3IP49YFaqFBGjPj1FdeUZ9/RPNlFOvNc2qfVjHXlmnVjH6FwcMydIy7o5ihQbSpa5TmJjEmQpQjYWpXTmOMncW4eoZSJEzhwR0KU9fRY+uHYnoV2qaBNnOT8uwE+ReP0abHaY6coHZjmMblU+xfPEljdIhidJpqJEx5bpL8s4dYeuX/JRd+xMkuLlCdGqM5MoB97hjW+eM0QoPok5eojw75yncXF/g1H6W0+hq72fyrqQdNcXynUciTebdE8ekszeEBSvdvk32/RObrZ4QQpDdjpOMbCFVFVWRycoKWe9gcN1DYKduy2FZkZFlmd2mB3Idl1J2cTyBUpW3lJEJRECKF+n0TUysfluwp7MzfAamh6+zuZPxgJbGFSCbbREK0rUfmEwpUOcm2qtKy7Q6pdHDrab+Llv9NsVhkJ51CkWWER+6TyZ0EajLJ3t4eTle81C23+y8COI5DRdPIxr6RWf9IKh5DpFLIiS1+5nJ9Ay51O/rWsGtgvbJMQ6dumli2TbVSoVKt9m2LdNQquT2J/rF4fav3B88RwGMRH+wiAAAAAElFTkSuQmCC" alt=""/><picture><source type="image/avif" data-srcset="/static/76883c8778b65beea60b27f713e13503/87885/featured.avif 743w" sizes="100vw"/><source type="image/webp" data-srcset="/static/76883c8778b65beea60b27f713e13503/bf206/featured.webp 743w" sizes="100vw"/><img data-gatsby-image-ssr="" class="h-full w-full object-cover md:w-72" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/76883c8778b65beea60b27f713e13503/97cbe/featured.png" data-srcset="/static/76883c8778b65beea60b27f713e13503/97cbe/featured.png 743w" alt="Front Picture"/></picture><noscript><picture><source type="image/avif" srcSet="/static/76883c8778b65beea60b27f713e13503/87885/featured.avif 743w" sizes="100vw"/><source type="image/webp" srcSet="/static/76883c8778b65beea60b27f713e13503/bf206/featured.webp 743w" sizes="100vw"/><img data-gatsby-image-ssr="" class="h-full w-full object-cover md:w-72" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/76883c8778b65beea60b27f713e13503/97cbe/featured.png" srcSet="/static/76883c8778b65beea60b27f713e13503/97cbe/featured.png 743w" alt="Front Picture"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div></div><div class="p-3"><div class="uppercase tracking-wide font-semibold text-gray-700">A Map of Localities Matching the Pattern</div><div class="block mt-1 text-sm text-gray-600 leading-tight font-medium ">11 July 2021</div><p class="mt-2 text-gray-500">Recently, interesting maps of Poland have been circulating on the Internet showing the occurrence of localities ending with various phrases (I have placed it…</p></div></div></div></a></div></div></div></main><footer class="flex flex-col text-white" style="background-color:#323232"><div><div class="md:w-128 m-auto py-8 px-4 flex flex-col"><div class="uppercase pb-2 font-bold text-sm text-gray-100 mb-2">You can find me there:</div><div><a class="text-gray-100 p-2 hover:text-blue-100" href="https://www.facebook.com/drozdkonrad" target="_blank" rel="noopener noreferrer"><svg aria-labelledby="svg-inline--fa-title-pgHBjdXBzxNW" data-prefix="fab" data-icon="facebook-square" class="svg-inline--fa fa-facebook-square fa-w-14 fa-3x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><title id="svg-inline--fa-title-pgHBjdXBzxNW">Facebook</title><path fill="currentColor" d="M400 32H48A48 48 0 0 0 0 80v352a48 48 0 0 0 48 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.27c-30.81 0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H400a48 48 0 0 0 48-48V80a48 48 0 0 0-48-48z"></path></svg></a><a class="text-gray-100 p-2 hover:text-blue-100" href="https://github.com/kkdrz" target="_blank" rel="noopener noreferrer"><svg aria-labelledby="svg-inline--fa-title-A85BjAWjESBX" data-prefix="fab" data-icon="github-square" class="svg-inline--fa fa-github-square fa-w-14 fa-3x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><title id="svg-inline--fa-title-A85BjAWjESBX">Github</title><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a><a class="text-gray-100 p-2 hover:text-blue-100" href="https://www.linkedin.com/in/konrad-drozd-3a1021121/" target="_blank" rel="noopener noreferrer"><svg aria-labelledby="svg-inline--fa-title-P60gO1xbvMis" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14 fa-3x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><title id="svg-inline--fa-title-P60gO1xbvMis">LinkedIn</title><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a class="text-gray-100 p-2 hover:text-blue-100" href="https://www.instagram.com/konradrzd/" target="_blank" rel="noopener noreferrer"><svg aria-labelledby="svg-inline--fa-title-Kq6pewoG5lIx" data-prefix="fab" data-icon="instagram-square" class="svg-inline--fa fa-instagram-square fa-w-14 fa-3x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><title id="svg-inline--fa-title-Kq6pewoG5lIx">Instagram</title><path fill="currentColor" d="M224,202.66A53.34,53.34,0,1,0,277.36,256,53.38,53.38,0,0,0,224,202.66Zm124.71-41a54,54,0,0,0-30.41-30.41c-21-8.29-71-6.43-94.3-6.43s-73.25-1.93-94.31,6.43a54,54,0,0,0-30.41,30.41c-8.28,21-6.43,71.05-6.43,94.33S91,329.26,99.32,350.33a54,54,0,0,0,30.41,30.41c21,8.29,71,6.43,94.31,6.43s73.24,1.93,94.3-6.43a54,54,0,0,0,30.41-30.41c8.35-21,6.43-71.05,6.43-94.33S357.1,182.74,348.75,161.67ZM224,338a82,82,0,1,1,82-82A81.9,81.9,0,0,1,224,338Zm85.38-148.3a19.14,19.14,0,1,1,19.13-19.14A19.1,19.1,0,0,1,309.42,189.74ZM400,32H48A48,48,0,0,0,0,80V432a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V80A48,48,0,0,0,400,32ZM382.88,322c-1.29,25.63-7.14,48.34-25.85,67s-41.4,24.63-67,25.85c-26.41,1.49-105.59,1.49-132,0-25.63-1.29-48.26-7.15-67-25.85s-24.63-41.42-25.85-67c-1.49-26.42-1.49-105.61,0-132,1.29-25.63,7.07-48.34,25.85-67s41.47-24.56,67-25.78c26.41-1.49,105.59-1.49,132,0,25.63,1.29,48.33,7.15,67,25.85s24.63,41.42,25.85,67.05C384.37,216.44,384.37,295.56,382.88,322Z"></path></svg></a></div></div></div><div class="text-xs text-gray-300" style="background-color:#222"><div class="md:w-128 py-4 px-4 m-auto">Copyright © 2020-<!-- -->2021<!-- --> Konrad Drozd. All rights reserved.</div></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/sip-proxy-with-netty-and-sipstack/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-1cdceeea2ed24573a5f9.js"],"app":["/app-d98e73955c33fd88eeda.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f2633d1d7764d92b544f.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-b59689d1e2485b8f79f1.js"],"component---src-pages-index-js":["/component---src-pages-index-js-601540839fdb0c0d8b75.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-900fa5193ce448ea9d66.js"]};/*]]>*/</script><script src="/polyfill-1cdceeea2ed24573a5f9.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-900fa5193ce448ea9d66.js" async=""></script><script src="/commons-16bf0c30a7860245d045.js" async=""></script><script src="/a9a7754c-84717cf9e6591c2c5321.js" async=""></script><script src="/app-d98e73955c33fd88eeda.js" async=""></script><script src="/framework-a0275a8146aade7c3fca.js" async=""></script><script src="/webpack-runtime-cfd69c61caf676285c38.js" async=""></script></body></html>